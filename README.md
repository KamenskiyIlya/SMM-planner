# SMM-planner

Данный проект представляет из себя контент планер. Он позволяет Вам выкладывать в различные соцсети (ВКонтакте, Одноклассники, Telegram) посты, указывать время для постинга, делать их временными и удалять. Организовано это все через удобную Google таблицу. Помимо этого данная таблица будет из себя представлять ещё и SMM календарь, ведь Вы будете видеть всю необходимую информацию о Ваших постах.

### Поддержка форматов:

    - Текстовые сообщения
    - Изображения (JPG, PNG)
    - GIF-анимации
    - Документы

## Архитектура проекта

Программа состоит из нескольких модулей, каждый из которых выполняет свою конкретную задачу:
```Bash
general_smm_publisher.py     # Основной оркестратор, управляет всем процессом
vk_publisher.py              # Публикация и удаление постов во ВКонтакте
ok_publisher.py              # Публикация и удаление постов в Одноклассниках
tg_publisher.py              # Публикация и удаление постов в Telegram

utils/google_api.py          # Работа с Google Sheets API
utils/google_docs_api.py     # Извлечение контента из Google Docs
utils/logger.py              # Логирование всех операций
utils/safe_publish.py        # Безопасный вызов API с повторными попытками
utils/exceptions.py          # Кастомные исключения для обработки ошибок
utils/ok_md5hex.py           # Вспомогательные функции для работы с OK API
```

## Необходимые настройки

Первым делом, Вам необходимо скопировать [шаблон google таблицы](https://docs.google.com/spreadsheets/d/1xXmrUItW77YpIHAv3Qh0bDOB6SbjLRBWTQwSAfn_tpw/edit?usp=sharing) к себе в аккаунт:

<img width="973" height="520" alt="image" src="https://github.com/user-attachments/assets/16ec5508-af76-4462-bbed-4b32d77b87c8" />

И скачать репозиторий с проектом в любой удобное место:

<img width="1152" height="526" alt="image" src="https://github.com/user-attachments/assets/781e44b6-3a50-4e41-80e3-84326b3a7d0a" />

## Настройка переменных окружения

Создайте файл .env в корне проекта и добавьте в него следующие переменные:

```env
# Telegram
TG_BOT_TOKEN='ваш_токен_бота'
CHAT_ID='@ID_Вашей_группы'

# ВКонтакте
VK_API_TOKEN='ваш_user_access_token'
VK_GROUP_ID='id_вашей_группы_без_минуса'

# Одноклассники
OK_APP_PUBLIC_KEY='ваш_публичный_ключ'
OK_SESSION_SECRET_KEY='ваш_секретный_ключ'
OK_ACCESS_TOKEN='ваш_токен_доступа'
OK_GROUP_ID='id_вашей_группы'
```
в него по мере настройки будем добавлять ключи для взаимодействия с соцсетями.
> Данный файл не должен иметь расширение .txt

### Настраиваем доступ программы к таблице

Для того, чтобы эта программа могла считывать и записывать данные с таблицы, необходимо настроить к ней доступ.

У Вас должен быть аккаунт Google, если его нет можно создать на этой [странице](https://accounts.google.com/lifecycle/steps/signup/name?dsh=S-970504023:1769350024505370&flowEntry=SignUp&flowName=GlifWebSignIn&TL=APgKAcbniJFKQ1u6BikOMbsP1J7SWz1nJ0bdO__Ytkv1iwDgxlh6IuuyptWQVN01&continue=https://accounts.google.com/ManageAccount?nc%3D1). Создаем проект на странице [создания проектов](https://console.cloud.google.com/projectcreate):

<img width="790" height="600" alt="image" src="https://github.com/user-attachments/assets/c486556e-a3ff-4539-a31a-8a00badef4b2" />

Далее переходим на [страницу](https://console.cloud.google.com/iam-admin/serviceaccounts) и создаем сервисный аккаунт:

<img width="1353" height="427" alt="image" src="https://github.com/user-attachments/assets/ff6a9a4a-f7e6-4e34-9197-ccf1c800a49c" />

После того как создан сервисный аккаунт, нажимаем на три точки рядом с ним и нажимаем `manage keys`:

<img width="1587" height="575" alt="image" src="https://github.com/user-attachments/assets/03c08633-6050-43fa-beed-1d54119cdbf2" />

Затем нажимаете внизу кнопку `Add key` и в открывшемся меню `Create new key`:

<img width="1192" height="610" alt="image" src="https://github.com/user-attachments/assets/6ecb03e8-15f7-4156-bd10-dc10fb27e4c6" />

Выбираете формат `JSON`:

<img width="669" height="228" alt="image" src="https://github.com/user-attachments/assets/5446eaf3-cc5c-444f-9c22-2e3cd39fda6f" />

Начнется закачка файла с ключом к сервисному аккаунту, никому не сообщайте его, с его помощью программа будет получать доступ к Google таблице. После того как файл загрузился, перенесите его в директорию проекта и переименуйте в `token.json`.

После создания ключа, Вам будет предложено скачать файл с токеном, обязательно это делаете и сохраняете его в директорию программы.

Активируем Google Sheets API, для этого переходим по [ссылке](https://console.cloud.google.com/marketplace/product/google/sheets.googleapis.com) и нажимаем кнопку `Enable`:

<img width="901" height="448" alt="image" src="https://github.com/user-attachments/assets/58416053-b325-4d39-932e-8b939e7f2548" />

Дальше, на [странице](https://console.cloud.google.com/iam-admin/serviceaccounts) с информацией о сервисном аккаунте копируем его адрес:

![Снимок экрана 2026-01-25 173748 (1) (1)](https://github.com/user-attachments/assets/96df921a-1c6a-4103-814d-d9a2616562be)

Открывает скопированный шаблон таблицы и даете доступ к этой таблице как редактору Вашему сервисному аккаунту указывая его адрес в отмеченном поле:

<img width="1836" height="378" alt="image" src="https://github.com/user-attachments/assets/897660b5-2941-4c61-881f-4bd4fa30d7cc" />

Проверяем, помимо Вас в доступах должен появиться и сервисный аккаунт:

![Снимок экрана 2026-01-25 174645 (1)](https://github.com/user-attachments/assets/30208a61-05f7-4463-95e6-14bff74fddd6)

## Настройка Google Docs

Посты будут записываться в Google Docs, поэтому их оттуда необходимо получить, делать мы будет это также с помощью уже созданного сервисного аккаунта. Для того это стало возможным необходимо в аккаунте включить следующие расширения: [Google Docs API](https://console.cloud.google.com/apis/library/docs.googleapis.com) и [Google Drive API](https://console.cloud.google.com/apis/library/drive.googleapis.com).

<img width="716" height="308" alt="image" src="https://github.com/user-attachments/assets/1408067a-60ac-488d-b28a-5b4f3341fdec" />

## Получения ключа от Telegram

Для постинга в телеграмм, необходимо создать бота. По ссылке можете найти подробную [инструкцию по его настройке](https://way23.ru/%D1%80%D0%B5%D0%B3%D0%B8%D1%81%D1%82%D1%80%D0%B0%D1%86%D0%B8%D1%8F-%D0%B1%D0%BE%D1%82%D0%B0-%D0%B2-telegram.html). Создаете бота, добавляете его в свою группу по инструкции и получаете ключ от бота(token).

После того как мы получили от [@BotFather](https://telegram.me/BotFather) ключ к боту с помощью команды `/token`, добавляем его в наш файл `.env`.

Также нам необходимо узнать id нашей группы в telegram. Для этого заходите в группу, в верхнем правом углу нажимаете 3 точки, там мы увидим id нашей группы:

<img width="486" height="277" alt="image" src="https://github.com/user-attachments/assets/5ea29970-ead6-4852-928f-9b02d1a90e55" />

, добавляем его в наш файл `.env` c @.

## Получение ключа от Vkontakte

Для постинга в ВК, необходимо зарегистрировать на [VK](https://vk.com/) и затем создать сообщество. Для этого заходим на страницу [Сообщества ВК](https://vk.com/groups) и нажимаем Создать Сообщество. После предварительной настройки, перейдите в "Управление" Сообществом, там Вы сразу увидете ID сообщества, копируем добавляем его в наш файл `.env`:

<img width="947" height="241" alt="image" src="https://github.com/user-attachments/assets/f48f9b24-6eb7-48f0-a765-885f01ec7484" />

Для настройки постинга GIF картинов в ВК необходимо переключить флажок в Отключенных разделах -> Файлы в меню Разделы.

<img width="927" height="583" alt="image" src="https://github.com/user-attachments/assets/37ca7cf4-8ed5-48c6-a6ef-b784cb8ef4e6" />

В связи с тем что что получить `VK_API_TOKEN` - он же access token при создании нового приложения очень проблематично, так как он не даёт все необходимые права "wall, photos, groups, offline", 
предлагаем перейти по ссылке [Получить access token](https://vkhost.github.io/), выбрать приложение Kate Mobile -> Затем нажмите "разрешить" -> Скопируйте часть адресной строки от access_token= до &expires_in b добавьте его в наш файл `.env`.

## Получение ключа от Одноклассников

Для постинга в ОК, необходимо зарегистрироваться на [OK](https://ok.ru/) и затем создать группу. Для этого заходим на страницу [Группы ОК](https://ok.ru/groups) и в верхнем правом углу нажимаем "Создать Группу". После предварительной настройки группы, перейдите в "Настройки" Группы нажав три точки рядом с названием, там Вы сразу увидете ID группы `OK_GROUP_ID`, копируем и добавляем его в наш файл `.env`:

<img width="805" height="294" alt="image" src="https://github.com/user-attachments/assets/7108bac9-be89-49b5-a212-310f02cd9895" />

Для получения необходимых Токенов для постинга в ОК, нам необходимо создать приложение, для этого перейдите по ссылке [Создание приложения](https://apiok.ru/dev/app/create). Далее по инструкции всё подробно расписано как это сделать, наша задача создать OAuth-приложение.

<img width="990" height="582" alt="image" src="https://github.com/user-attachments/assets/a083837b-4da7-425a-a0d1-e9a26321e5c0" />

После создания приложения Вам на указанную при регистрации аккаунта почту прийдёт письмо с "Публичным ключом приложения" `OK_APP_PUBLIC_KEY` и "Секретным ключом приложения" - он необходим, чтобы логиниться в настройки созданного приложения, публичный ключ добавьте в наш файл `.env`. 

Далее в настройках приложения Вы должны изменить поля с правами доступа на обязательные и после нажать Получить вечный assecc_token как на изображении ниже, а так же добавить платформу Oath-приложения. После нажатия получения assecc_token, у Вас появится 2 ключа `OK_ACCESS_TOKEN` и `OK_SESSION_SECRET_KEY`, оба копируем и добавляем в наш файл `.env`

<img width="1010" height="632" alt="image" src="https://github.com/user-attachments/assets/08689590-1205-413e-aaa4-9f5bde58cb99" />

## Настройка Python

Для работы данной программы у Вас должен быть установлен [python3](https://www.python.org/downloads/).

Далее открываем консоль `cmd`, переходим в директорию с проектом, введя следующую команду:
```
cd путь к директории
```
Дальше устанавливаем необходимые пакеты python с помощью команды:
```
pip install -r requirements.txt
```
После чего необходимо запустить основной скрипт на Вашем компьютере или на сервере через консоль с помощью команды:
```
python general_smm_publisher.py
```
После запуска скрипта сервис постинга будет работать до тех пор, пока включен этот скрипт, вы должны увидеть следующее сообщение в консоли:

<img width="1088" height="142" alt="image" src="https://github.com/user-attachments/assets/9c2504e5-bb5f-41fd-972e-0638536ec212" />

## Как работать с таблицей

Создаете пост в Google Docs с тектом и фото, после чего копируете ссылку на данный документ:

<img width="1473" height="448" alt="image" src="https://github.com/user-attachments/assets/00f991d1-aa18-4eeb-a0e5-7dd11c85d9a6" />

Вставляете ссылку на пост созданный в Google Docs в столбик `ссылка на пост`. Далее проставляете время(если укажите только дату, будет выбрано стандартное время 13:00), когда пост необходимо выпустить. После чего галочками отмечаете соцсети в которых необходимо выложить Ваш пост:

<img width="1683" height="180" alt="image" src="https://github.com/user-attachments/assets/d86a6874-9b23-4e5c-b9bf-b131dae17109" />

Когда придет время выложить пост, программа попробует его выложить в указанную соцсеть, если все пройдет удачно, в таблице отметится галочка `Пост в ...` и в столбике `ID поста в ...` появится номер Вашего поста. Если же возникнет какая-то ошибка, об этом будет написано в столбце `ID поста в ...`.

Также у программы есть возможность выкладывать временные посты на 8 часов. После истечения этого времени пост будет автоматически удален. От Вас нужно только поставить галочку в столбце `Временный пост`.

Если Вы захотели удалить какой-то пост, поставьте галочку в столбцах `Удалить пост в ...`. Если пост успешно удалится в столбце `ID поста в ...` об этом будет сообщено, а галочки публикации будут сняты.

## Основной оркестратор (general_smm_publisher.py)

1) Управление процессом публикации:

```Python
main() - основной цикл программы, который непрерывно проверяет и обрабатывает посты
```

2) Работа с таблицей:
   
```Python
check_post_datetime() - проверяет корректность формата времени в таблице и добавляет стандартное время, если оно не указано
read_cell() - безопасное чтение ячейки по индексу с установкой значения по умолчанию
find_posts_must_posted() - собирает строки из таблицы, которые нужно опубликовать
find_posts_must_delete() - собирает строки из таблицы, которые нужно удалить
check_temporary_posts() - проверяет временные посты и автоматически помечает их для удаления
```

3) Обработка контента:
  
```Python
load_post_content() - загружает текст и изображение из Google Docs
guess_extension() - пытается определить расширение файла по пути, URL или файловому объекту
posting_posts() - публикует все посты в указанные соцсети из списка постов на постинг
delete_posts() - удаляет посты из соцсетей, которые помечены на удаление
```

## Публикация во ВКонтакте (vk_publisher.py)

Базовые операции с API, Загрузка меди, Публикация и управление:
   
```Python
_vk_call() - универсальный метод для вызовов VK API с обработкой ошибок
upload_photo_for_wall() - загружает изображение на сервер ВКонтакте для публикации на стене
upload_gif_for_wall() - загружает GIF-анимацию как документ для публикации на стене
publish_post_to_vk() - публикует пост с текстом и медиа во ВКонтакте
delete_post_from_vk() - удаляет пост со стены ВКонтакте по его ID
```

## Публикация в Одноклассниках (ok_publisher.py)

Работа с OK API, Загрузка изображений, Публикация и управление:
   
```Python
ok_api_response() - выполняет вызовы к API Одноклассников с формированием подписи
make_sig() - создает сигнатуру для запросов к OK API
get_upload_url() - получает URL для загрузки изображений в OK
upload_photo() - загружает изображение на сервер Одноклассников
publish_group_post() - публикует пост в группе Одноклассников
publish_post_to_ok() - основной метод для публикации поста в OK
delete_post_from_ok() - удаляет пост из Одноклассников
```

## Публикация в Telegram (tg_publisher.py)

Настройка бота, Публикация контента:
   
```Python
_get_bot() - инициализирует и возвращает объект бота Telegram
_is_url() - проверяет, является ли значение URL-адресом
publish_post_to_tg() - публикует пост в Telegram канале с поддержкой различных форматов медиа
delete_post_from_tg() - удаляет сообщение из Telegram канала
```

## Работа с Google API и Google Docs
   
```Python
--- Google Sheets ---
auth_in_google_sheets() - создает экземпляр для доступа к Google Sheets API
get_sheet_content() - получает данные из Google таблицы
update_cell() - обновляет значение конкретной ячейки в таблице
normalize_text() - нормализует текст (заменяет кавычки, тире, убирает лишние пробелы)

--- Google Docs ---
auth_docs() - создает экземпляр для доступа к Google Docs API
extract_doc_id() - извлекает ID документа из URL
extract_text_from_doc() - извлекает текст из документа Google Docs
extract_first_image() - извлекает первое изображение из документа
get_post_content_from_gdoc() - основной метод, который получает текст и изображение из Google Docs документа
```

## Обработка ошибок:

- Логирование всех операций
- Повторные попытки при сетевых ошибках
- Информирование об ошибках в логе











